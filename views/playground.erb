<%
@default_text = "Click 'Convert to JSON' when your MODL string is complete."
@process_url = "/playground-process"

if params[:version] == "java" then
  @process_url = "https://api.modl.uk"
end
%>
<script>
$(document).delegate('#modl', 'keydown', function(e) {
  $("#status").html("<%=@default_text%>");
  $("#status").removeClass("success error");
  var keyCode = e.keyCode || e.which;
  tabsOrSpaces = $("#tabsOrSpaces").val();
  tabsOrSpacesArray = tabsOrSpaces.split("-");
  useChar = tabsOrSpacesArray[0];
  charRepeat = Number(tabsOrSpacesArray[1]);

  if(useChar=="tab"){
    indentChar = "\t";
  }
  else{
    indentChar = " ";
  }

  if (keyCode == 9) {
    e.preventDefault();
    var start = this.selectionStart;
    var end = this.selectionEnd;

    // set textarea value to: text before caret + tab + text after caret
    $(this).val($(this).val().substring(0, start)
                + indentChar.repeat(charRepeat)
                + $(this).val().substring(end));

    // put caret at right position again
    this.selectionStart =
    this.selectionEnd = start + charRepeat;
  }
});
</script>  
<h1>MODL Playground</h1>
  <p>
    You can use the tool below to experiment with MODL.
  </p>
  <h3>Enter your MODL string</h3>
  <div class="nm">
    Tab key = 
    <select id="tabsOrSpaces">
      <option value="space-1">1 space</option>
      <option value="space-2" selected>2 spaces</option>
      <option value="space-4">4 spaces</option>
      <option value="space-8">8 spaces</option>
      <option value="tab-1">1 tab</option>
      <option value="tab-2">2 tabs</option>
    </select>
  </div>
  <style>
  #modl{
    width:100%;
    height:300px;
  }
  #json{
    height:500px;
  }
  </style>
  <%= erb :_playground %>